<html>
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta http-equiv="X-UA-Compatible" content="ie=edge" />
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>    
    </head>
    <body>
        <div class="container bg-white my-2 py-2 rounded">
            <h1 class="display-3 py-3 text-center">Produkty:</h1>
            <div class="row justify-content-around" id="products-container">
            </div>
        </div>
        <div class="container">
            <form id="add_product">
                <div class="form-group">
                  <label for="name">Nazwa</label>
                  <input type="text" class="form-control" id="name" >
                </div>
                <div class="form-group">
                    <label for="type">Typ</label>
                    <input type="text" class="form-control" id="type" >
                </div>
                <div class="form-group">
                    <label for="qty">Ilość</label>
                    <input type="number" class="form-control" id="qty" >
                </div>
                <div class="form-group">
                    <p>Wyprzedaż:<p>
                        <label><input type="radio" name="onsale" value="false" checked> Nie</label>
                        <label><input type="radio" name="onsale" value="true"> Tak</label>
                </div>
                <button type="submit" class="btn btn-primary" >Dodaj</button>
              </form>
        </div>
        <script type="module">
            // Import the functions you need from the SDKs you need
            import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js"
            // TODO: Add SDKs for Firebase products that you want to use
            // https://firebase.google.com/docs/web/setup#available-libraries
            
            // Firestore
            import { getFirestore } from 'https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore.js'
            import { collection, getDocs, addDoc } from 'https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore.js'

            // Your web app's Firebase configuration
            const firebaseConfig = {
                apiKey: "AIzaSyCHVbRkl1VqKq8qvIw68CYnsecsih0__y4",
                authDomain: "psm-ao.firebaseapp.com",
                projectId: "psm-ao",
                storageBucket: "psm-ao.appspot.com",
                messagingSenderId: "753348093150",
                appId: "1:753348093150:web:dc55446f081cc09f328e4f",
                measurementId: "G-DX63V0FH2C"
            };
          
            // Initialize Firebase
            const app = initializeApp(firebaseConfig);

            // Initialize Cloud Firestore and get a reference to the service
            const db = getFirestore(app);

            // Read data
            const querySnapshot = await getDocs(collection(db, "products"));
            
            querySnapshot.forEach((doc) => {
                console.log(doc.data());
                var container = document.getElementById('products-container');
                var data =  `
                <div class="col-md-4 mx-auto my-1" style="width: 18rem">
                    <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">${ doc.data()['name']}</h5>
                        <h6 class="card-subtitle mb-2 text-muted">Ilość: ${ doc.data()['qty']}</h6>
                        <h6 class="card-subtitle mb-2 text-muted">Rodzaj: ${ doc.data()['type']}</h6>
                        ${ doc.data()['onsale']=="true" ? '<h6 class="card-subtitle mb-2 text-muted">WYPRZEDAŻ</h6>' : ''}
                    </div>
                    </div>
                </div>
                `;
                container.innerHTML += (data);

            });

            const form = document.getElementById('add_product');
            form.addEventListener('submit', (e) => 
            {
                e.preventDefault();
                var name = document.getElementById("name").value;
                var qty = parseInt(document.getElementById("qty").value);
                var type = document.getElementById("type").value;
                var onsale = Boolean(document.querySelector('input[name="onsale"]:checked').value);
                addDoc(collection(db,'products'), {
                    name: name,
                    qty: qty,
                    type: type,
                    onsale: onsale
                });
                var container = document.getElementById('products-container');
                var data =  `
                <div class="col-md-4 mx-auto my-1" style="width: 18rem">
                    <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">${ name }</h5>
                        <h6 class="card-subtitle mb-2 text-muted">Ilość: ${ qty }</h6>
                        <h6 class="card-subtitle mb-2 text-muted">Rodzaj: ${ type }</h6>
                        ${ onsale ? '<h6 class="card-subtitle mb-2 text-muted">WYPRZEDAŻ</h6>' : ''}
                    </div>
                    </div>
                </div>
                `;
                container.innerHTML += (data);
                form.reset();
            }
            );


        </script>
    </body>
</html>